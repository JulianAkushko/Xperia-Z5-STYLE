ui_print("");ui_print("");ui_print("");

ui_print("* Xperia Z5 STYLE OTA Update 2 *");
run_program("/sbin/busybox", "sleep", "3");
show_progress(1.000000, 0);

ui_print("- Mounting system...");
run_program("/sbin/busybox", "blockdev", "--setrw", "/dev/block/platform/msm_sdcc.1/by-name/system");
run_program("/sbin/busybox", "mount", "/system");
set_progress(0.150000);

ui_print("- Extracting OTA files to system...");
package_extract_dir("system", "/system");
set_progress(0.300000);

ui_print("- Correcting file permissions...");
set_perm_recursive(0, 0, 0755, 0644, "/system/app");
set_perm_recursive(0, 0, 0755, 0644, "/system/priv-app");
set_perm(0, 0, 0644, "/system/lib/libchromatix_imx134_SOI08BS2_liveshot.so");
set_perm(0, 0, 0644, "/system/lib/libchromatix_imx134_SOI08BS2_video_hd.so");
set_perm(0, 0, 0644, "/system/lib/hw/camera.msm8226.so");
set_perm(0, 0, 0644, "/system/vendor/camera/morpho_denoiser.cfg");
set_perm(0, 0, 0644, "/system/vendor/camera/morpho_denoiser_subcam.cfg");
set_perm(0, 0, 0644, "/system/vendor/camera/morpho_denoiser_subcam_preview.cfg");
set_perm(0, 0, 0644, "/system/vendor/camera/morpho_face_detection.cfg");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_default_video.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_liveshot_beach.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_liveshot_landscape.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_liveshot_night.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_liveshot_party.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_liveshot_portrait.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_liveshot_snow.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_liveshot_sports.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_anti_motion_blur.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_baby.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_backlight.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_backlight_portrait.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_beach.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_dark.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_dish.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_document.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_fireworks.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_handheld_twilight.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_high_sensitivity.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_landscape.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_macro.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_night.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_night_portrait.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_party.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_pet.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_portrait.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_snow.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_soft_skin.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_sports.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_spot_light.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_preview_sweep_stitch.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_anti_motion_blur.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_baby.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_backlight.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_backlight_portrait.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_beach.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_dark.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_dish.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_document.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_fireworks.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_handheld_twilight.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_high_sensitivity.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_landscape.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_macro.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_night.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_night_portrait.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_party.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_pet.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_portrait.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_snow.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_soft_skin.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_sports.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_spot_light.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_snapshot_sweep_stitch.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_video_beach.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_video_landscape.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_video_night.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_video_party.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_video_portrait.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_video_snow.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libchromatix_imx134_SOI08BS2_video_sports.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libmmcamera2_iface_modules.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libmmcamera2_imglib_modules.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libmmcamera2_isp_modules.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libmmcamera2_sensor_modules.so");
set_perm(0, 0, 0644, "/system/vendor/lib/libmmcamera2_stats_modules.so");
set_perm(0, 0, 0644, "/system/vendor/lib/liboemcamera.so");
set_progress(0.500000);

ui_print("- Replacing Build.prop");
package_extract_file("common/busybox", "/tmp/busybox");
set_perm(0, 0, 0755, "/tmp/busybox");
package_extract_file("common/buildprop.sh", "/tmp/buildprop.sh");
set_perm(0, 0, 0755, "/tmp/buildprop.sh");
package_extract_dir("common/buildprop", "/tmp/buildprop");
run_program("/tmp/buildprop.sh");
set_progress(0.750000);

ui_print("- Replacing StopRic script");
package_extract_file("common/stopric.sh", "/tmp/stopric.sh");
set_perm(0, 0, 0755, "/tmp/stopric.sh");
run_program("/tmp/stopric.sh");
set_progress(0.990000);

ui_print("- Recogiendo la casa :D");
delete_recursive("/tmp/");

ui_print("- Unmounting system...");
unmount("/system");

set_progress(1.000000);
ui_print("Finished!");
ui_print("Automatically rebooting in 5 seconds");
run_program("/sbin/busybox", "sleep", "5");
